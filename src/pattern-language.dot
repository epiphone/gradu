digraph g{
  rankdir="LR"
  newrank="true"

  subgraph cluster_composition {
    label="Composition patterns"
    rank="same"
    "Routing Function";
    "Function Chain";
    "Fan-in/Fan-out";
    "State Machine";
    "Thick Client";
  }
  // "Routing Function" -> "Externalized State" [label="can store configuration in"];
  // "Function Chain" -> "Externalized State" [label="stores result in"];
  "Fan-in/Fan-out" -> "Externalized State" [label="uses"];
  "Thick Client" -> "Valet Key" [label="authorized by"];

  subgraph cluster_event {
    label="Event patterns"
    rank="same"
    "Event Processor";
    "Periodic Invoker";
    "Polling Event Processor";
    "Event Broadcast";
  }
  "Periodic Invoker" -> "Externalized State" [label="can store result in"];
  "Periodic Invoker" -> "Event Broadcast" [label="forwards result by"];
  "Polling Event Processor" -> "Periodic Invoker" [label="uses"];
  "Event Broadcast" -> "Event Processor" [label="extends"];

  subgraph cluster_api {
    label="API patterns"
    rank="same"
    "Aggregator";
    "Proxy";
    "Strangler";
  }
  "Aggregator" -> "Proxy" [label="a form of"];
  "Strangler" -> "Routing Function" [label="uses"];
  "Strangler" -> "Proxy" [label="implements"];

  subgraph cluster_data {
    label="Data management patterns"
    rank="same"
    "Externalized State";
    "Valet Key";
  }

  subgraph cluster_performance {
    label="Performance patterns"
    rank="same"
    "Function Warmer";
    "Singleton";
  }
  "Function Warmer" -> "Periodic Invoker" [label="uses"];

  subgraph cluster_availability {
    label="Availability patterns"
    rank="same"
    "Bulkhead";
    "Throttler";
    "Circuit Breaker";
  }
  "Throttler" -> "Event Processor" [label="can use"];
  "Throttler" -> "Proxy" [label="protects"];
  "Circuit Breaker" -> "State Machine" [label="uses"];
  "Circuit Breaker" -> "Externalized State" [label="uses"];
  "Circuit Breaker" -> "Proxy" [label="protects"];
}
